<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guided solution (page 1 of 2) :: RHOSP Networking Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="section2.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">RHOSP Networking Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhosp-bfx019" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">RHOSP Networking Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Whatâ€™s in this break-fix?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Break-fix activity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section2.html">Check your work</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Guided solution</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section1.html">Guided solution (page 1 of 2)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Guided solution (page 2 of 2)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RHOSP Networking Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">RHOSP Networking Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">RHOSP Networking Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a></li>
    <li><a href="index.html">Guided solution</a></li>
    <li><a href="section1.html">Guided solution (page 1 of 2)</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Guided solution (page 1 of 2)</h1>
<div class="sect1">
<h2 id="_objectives"><a class="anchor" href="#_objectives"></a>Objectives</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Investigate the instance connectivity issue in Red Hat OpenStack Platform.</p>
</li>
<li>
<p>Solve the instance connectivity in the hands-on lab environment.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_outcomes"><a class="anchor" href="#_outcomes"></a>Outcomes</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Investigate why ssh to instance is not working.</p>
</li>
<li>
<p>Fix the ssh to instance failing issue.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Break the environment if you have not done it and step through the fix.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>[student@workstation ~]$ ssh student@director
Warning: Permanently added 'director' (ED25519) to the list of known hosts.
student@director's password:
Activate the web console with: systemctl enable --now cockpit.socket

Register this system with Red Hat Insights: insights-client --register
Create an account or view all your systems at https://red.ht/insights-dashboard
Last login: Fri Jan 26 10:45:39 2024 from 172.25.252.254

[student@director ~]$ sudo su - stack
[sudo] password for student:
Last login: Thu Feb 29 10:37:46 EST 2024 from 172.25.250.9 on pts/0

[stack@director ~]$ source overcloudrc

(overcloud) [stack@director ~]$ lab start bfx020
Running start action against scenario bfx020
Run the following command:
ssh -i /home/stack/osp_training/.scenariobfx020/scenario-bfx020-key.pem cirros@172.25.250.217</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You need single instance of the lab environment to perorm all the break-fix activities in this series.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the ssh command from the previous lab command output and notice the Connection timed out error. Also run the ping command against instance IP.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>(overcloud) [stack@director ~]$ ssh -i /home/stack/osp_training/.breakfix020/breakfix020-key.pem cirros@172.25.250.217
ssh: connect to host 172.25.250.217 port 22: Connection timed out

(overcloud) [stack@director ~]$ ping 172.25.250.217 -c 1
PING 172.25.250.217 (172.25.250.217) 56(84) bytes of data.

--- 172.25.250.217 ping statistics ---
1 packets transmitted, 0 received, 100% packet loss, time 0ms</pre>
</div>
</div>
<div class="paragraph">
<p>You observe that both ping and ssh attempts failed which indicates lack of connectivity.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the overcloud environment and determine the specific compute VM where the instance is currently running.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>(overcloud) [stack@director ~]$ openstack server list --long -c Name -c Status -c Networks -c Host
+--------------------+--------+---------------------------------------------------------+-------------------------------------+
| Name               | Status | Networks                                                | Host                                |
+--------------------+--------+---------------------------------------------------------+-------------------------------------+
| scenario-bfx020-vm | ACTIVE | scenario-bfx020-network=172.25.250.217, 192.168.120.152 | overcloud-novacompute-1.localdomain |
+--------------------+--------+---------------------------------------------------------+-------------------------------------+</pre>
</div>
</div>
<div class="paragraph">
<p>Host in the preceding output can differ in your environment.
scenario-bfx020-vm is running on the overcloud-novacompute-1 host.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Examine the ARP cache on the director VM and look for the details of the inaccessible OpenStack instance.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>(overcloud) [stack@director ~]$ ip neighbor | grep 172.25.250.217
172.25.250.217 dev eth0 lladdr fa:16:3e:06:d9:00 STALE</pre>
</div>
</div>
<div class="paragraph">
<p>An entry with the floating IP associated with a MAC address, indicating successful ARP negotiation.
This signifies functional communication via ARP, but ICMP communication remains problematic.
Proceed to verify whether the packets are being correctly routed to the appropriate VM.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open an another terminal and run the ssh command to log in to the compute VM where the instance is hosted.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Run the ovs-vsctl show command to find the interface associated with the external bridge br-ex.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[student@workstation ~]$ ssh student@director
student@director's password:
Activate the web console with: systemctl enable --now cockpit.socket

Register this system with Red Hat Insights: insights-client --register
Create an account or view all your systems at https://red.ht/insights-dashboard
Last login: Fri Mar  1 05:04:42 2024 from 172.25.250.9

[student@director ~]$ sudo su - stack
[sudo] password for student:
Last login: Fri Mar  1 05:04:50 EST 2024 on pts/0

(overcloud) [stack@director ~]$ ssh tripleo-admin@overcloud-compute1
Register this system with Red Hat Insights: insights-client --register
Create an account or view all your systems at https://red.ht/insights-dashboard
Last login: Fri Jan 26 12:15:25 2024 from 172.25.249.11

[tripleo-admin@overcloud-novacompute-1 ~]$ sudo su -

[root@overcloud-novacompute-1 ~]# ovs-vsctl show
...output omitted...
    Bridge br-ex
        fail_mode: standalone
        Port br-ex
            Interface br-ex
                type: internal
        ...output omitted...
        Port ens4
            Interface ens4
...output omitted...</pre>
</div>
</div>
<div class="paragraph">
<p>Interface in the preceding output can differ in your environment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To verify incoming traffic, initiate a tcpdump on above interface on the compute VM and try to ping the instance from another terminal from the director VM.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@overcloud-novacompute-1 ~]# tcpdump -envvi ens4 icmp
dropped privs to tcpdump
tcpdump: listening on ens4, link-type EN10MB (Ethernet), snapshot length 262144 bytes
11:04:50.054084 52:54:00:04:fa:0b &gt; fa:16:3e:06:d9:00, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 22810, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 172.25.250.217: ICMP echo request, id 2, seq 1, length 64
11:04:51.095931 52:54:00:04:fa:0b &gt; fa:16:3e:06:d9:00, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 23812, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 172.25.250.217: ICMP echo request, id 2, seq 2, length 64
11:04:52.120036 52:54:00:04:fa:0b &gt; fa:16:3e:06:d9:00, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 23850, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 172.25.250.217: ICMP echo request, id 2, seq 3, length 64
^C
3 packets captured
3 packets received by filter
0 packets dropped by kernel

(overcloud) [stack@director ~]$ ping 172.25.250.217 -c 3
PING 172.25.250.217 (172.25.250.217) 56(84) bytes of data.

--- 172.25.250.217 ping statistics ---
3 packets transmitted, 0 received, 100% packet loss, time 2067ms</pre>
</div>
</div>
<div class="paragraph">
<p>Observe that ICMP echo requests arriving at the VM.</p>
</div>
<div class="paragraph">
<p>The presence of ICMP echo requests reaching the external NIC on the compute VM indicates the proper functioning of the Distributed Virtual Router (DVR).</p>
</div>
<div class="paragraph">
<p>However, observe that echo requests are not receiving the echo replies on the director VM.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Determine the tap interface used for the instance on the compute VM.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>(overcloud) [stack@director ~]$ openstack port list --server scenario-bfx020-vm
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------+--------+
| ID                                   | Name | MAC Address       | Fixed IP Addresses                                                             | Status |
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------+--------+
| 32311030-701f-462b-bc64-899e67ad6e78 |      | fa:16:3e:42:bb:e3 | ip_address='192.168.120.152', subnet_id='a587591a-1147-4c49-8d0d-32857a103a82' | ACTIVE |
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------+--------+</pre>
</div>
</div>
<div class="paragraph">
<p>The preceding output can differ in your environment.
The tap interface name is tap&lt;initial part of port ID&gt;. Refer to the Additional Information page for more details.
Here tap interface name is tap32311030-70.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run ip l show command on compute VM.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@overcloud-novacompute-1 ~]# ip l show tap32311030-70
18: tap32311030-70: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1442 qdisc noqueue master ovs-system state UNKNOWN mode DEFAULT group default qlen 1000
    link/ether fe:16:3e:42:bb:e3 brd ff:ff:ff:ff:ff:ff</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initiate a tcpdump on tap interface on the compute VM and try to ping the instance from another terminal from the director VM.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@overcloud-novacompute-1 ~]# tcpdump -envvi tap32311030-70
dropped privs to tcpdump
tcpdump: listening on tap32311030-70, link-type EN10MB (Ethernet), snapshot length 262144 bytes
06:06:55.836997 fa:16:3e:34:88:e6 &gt; fa:16:3e:42:bb:e3, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 63, id 58088, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 192.168.120.152: ICMP echo request, id 3, seq 1, length 64
06:06:56.855560 fa:16:3e:34:88:e6 &gt; fa:16:3e:42:bb:e3, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 63, id 58956, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 192.168.120.152: ICMP echo request, id 3, seq 2, length 64
06:06:57.879456 fa:16:3e:34:88:e6 &gt; fa:16:3e:42:bb:e3, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 63, id 59581, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 192.168.120.152: ICMP echo request, id 3, seq 3, length 64
^C
3 packets captured
3 packets received by filter
0 packets dropped by kernel

(overcloud) [stack@director ~]$ ping 172.25.250.217 -c 3
PING 172.25.250.217 (172.25.250.217) 56(84) bytes of data.

--- 172.25.250.217 ping statistics ---
3 packets transmitted, 0 received, 100% packet loss, time 2044ms</pre>
</div>
</div>
<div class="paragraph">
<p>Successful delivery of the echo request to the tap interface linked with the instance indicates that the network path and connectivity mechanisms are operating correctly.</p>
</div>
<div class="paragraph">
<p>All indicators appear satisfactory from the Neutron perspective. The underlying networking infrastructure, including OVN components, is functioning as intended.</p>
</div>
<div class="paragraph">
<p>It appeared that the virtual machine (VM) failed to generate a reply when the echo request reached it. The problem might reside within the VM internal configuration or its behavior towards incoming requests. Access the instance&#8217;s console for further investigation on this issue.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Guided solution</a></span>
  <span class="next"><a href="section2.html">Guided solution (page 2 of 2)</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
